import { useState, useEffect } from "react";
import styles from "./index.module.scss";

type Props = {
  productId: string;
  initialComparison?: boolean;
  onToggle?: (productId: string, isCompare: boolean) => void;
};

export default function ComparisonButton({ productId, initialComparison = false, onToggle }: Props) {
  const [isCompare, setIsCompare] = useState(initialComparison);

  useEffect(() => {
    setIsCompare(initialComparison);
  }, [initialComparison]);

  const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {
    e.stopPropagation();
    const newValue = !isCompare;
    setIsCompare(newValue);
    onToggle?.(productId, newValue);
  };

  return (
    <button
      className={styles.comparisonButton}
      onClick={handleClick}
      aria-label="Toggle comparison"
      type="button"
    >
      <svg
        className={isCompare ? styles.active : ""}
        width="32"
        height="32"
        viewBox="0 0 32 32"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M5.08274 6.45357L5.04861 6.288C5.01694 6.13434 4.93966 5.99381 4.82687 5.88476C4.69991 5.76201 4.53504 5.68599 4.35925 5.66914L4.17072 5.65106C4.02889 5.63746 3.88606 5.66326 3.75795 5.72563C3.62469 5.7905 3.51284 5.89225 3.4357 6.01881L3.41238 6.05707C3.32379 6.20242 3.27692 6.36935 3.27692 6.53957V6.6756C3.27692 6.88475 3.3234 7.09129 3.413 7.28028L3.44506 7.34792C3.5172 7.50009 3.61101 7.64102 3.72354 7.7663L3.87238 7.932C4.02845 8.10576 4.20855 8.25633 4.40721 8.37915L4.97444 8.72985C4.99115 8.74018 5.01041 8.74565 5.03006 8.74565C5.09505 8.74565 5.14467 8.80373 5.13452 8.86793L5.12736 8.91327C5.12453 8.93117 5.11837 8.94839 5.10919 8.96403L4.72308 9.62185L4.10769 10.7577L2.69231 13.7108L1.1861 16.7435C1.0637 16.99 1 17.2614 1 17.5366C1 17.7111 1.0256 17.8846 1.07599 18.0516L1.14281 18.2731C1.19113 18.4333 1.25136 18.5896 1.32302 18.7407L1.37237 18.8448C1.5135 19.1425 1.68438 19.4252 1.8824 19.6885L2.0041 19.8504C2.19579 20.1053 2.41177 20.341 2.64902 20.5541C2.96375 20.8369 3.31359 21.0779 3.68991 21.2713L3.9406 21.4001C4.19506 21.5308 4.46089 21.6381 4.73481 21.7207C5.17589 21.8536 5.63407 21.9211 6.09474 21.9211H6.35148C6.74178 21.9211 7.13106 21.8813 7.51328 21.8023C8.17111 21.6662 8.79993 21.4157 9.3711 21.0621L9.66157 20.8823C9.83549 20.7746 9.99848 20.6502 10.1482 20.5109C10.346 20.3268 10.5192 20.118 10.6636 19.8896L10.9732 19.3998C11.1545 19.1129 11.3017 18.8058 11.4116 18.4847L11.5511 18.0775C11.614 17.8936 11.6462 17.7005 11.6462 17.5062C11.6462 17.2506 11.5906 16.9981 11.4834 16.7661L10.4462 14.5221L9.61539 12.9969L9.03077 11.7637L8.2 10.1411L7.50501 8.82779C7.47903 8.77871 7.48727 8.71852 7.52548 8.67821C7.54393 8.65875 7.56798 8.6455 7.59429 8.6403L8.04615 8.55094L9.03077 8.29133L10.2 7.9019L11.1538 7.54493L11.4644 7.45758C11.8708 7.34328 12.291 7.28532 12.7132 7.28532H12.9662C13.1726 7.28532 13.3782 7.31044 13.5785 7.36015L13.7817 7.41059C14.1348 7.4982 14.4541 7.68805 14.6997 7.95634C15.0116 8.29706 15.1846 8.74224 15.1846 9.20417V11.1146V22.2457C15.1846 22.6277 15.0794 23.0024 14.8806 23.3286L14.5523 23.8671C14.4203 24.0838 14.2694 24.2884 14.1015 24.4787L12.5 26.2928L10.5 28.0001L9.72996 28.5242C9.29036 28.8234 9.01935 29.3139 9 29.8453C9.01713 30.4513 9.51333 30.9337 10.1196 30.9337H12.0769L17 30.9779H21.5C22.0593 30.9532 22.5 30.4926 22.5 29.9327V29.8453C22.5 29.11 22.133 28.4232 21.5217 28.0146L21.5 28.0001L19.5978 26.8588C19.2008 26.6206 18.8345 26.3346 18.5071 26.0072C17.846 25.3461 17.3589 24.5316 17.0892 23.6365L17.0147 23.3891C16.9029 23.0182 16.8462 22.633 16.8462 22.2457V11.1146V9.15272C16.8462 8.72312 17.0031 8.3083 17.2874 7.98623C17.5402 7.69981 17.8793 7.50329 18.2535 7.42628L18.6437 7.34598C18.8397 7.30564 19.0393 7.28532 19.2394 7.28532H19.3677C19.7768 7.28532 20.1837 7.34486 20.5756 7.46209L22.0462 7.9019L23.1897 8.39532C23.3293 8.45553 23.4762 8.4969 23.6267 8.51835L24.5051 8.64354C24.5259 8.64651 24.5439 8.65974 24.5529 8.67877C24.5629 8.69993 24.5604 8.72491 24.5462 8.74356L24.3589 8.99048C24.3351 9.02189 24.3146 9.05568 24.2977 9.0913L23.9846 9.75166L20.6991 16.5917C20.5326 16.9383 20.4462 17.3179 20.4462 17.7024C20.4462 17.9805 20.5045 18.2556 20.6173 18.5099L20.891 19.1265C21.0448 19.4732 21.2504 19.7945 21.5006 20.0795C21.7601 20.3751 22.0645 20.6281 22.4027 20.8291L22.9236 21.1388C23.3624 21.3996 23.8336 21.6014 24.3252 21.7389L24.3965 21.7589C24.8582 21.8881 25.3354 21.9536 25.8149 21.9536H25.9824C26.5528 21.9536 27.1178 21.8429 27.6461 21.6276C28.0137 21.4778 28.3594 21.2791 28.6738 21.0368L29.3207 20.5382C29.6388 20.293 29.9223 20.006 30.1637 19.6851L30.222 19.6075C30.4117 19.3553 30.5684 19.0799 30.6883 18.7879L30.7457 18.6484C30.853 18.3871 30.9193 18.1107 30.9422 17.8291C30.9801 17.363 30.898 16.8949 30.7038 16.4694L30.2 15.3658L28.7846 12.7048L27.4 9.91392L27.1421 9.31542C27.028 9.05075 27.1414 8.74312 27.4 8.61584L27.603 8.47963C27.9153 8.26999 28.1791 7.99581 28.3764 7.67557C28.4433 7.56699 28.5023 7.45368 28.5527 7.33655L28.6964 7.00334C28.7546 6.86823 28.7846 6.72265 28.7846 6.57553V6.5499C28.7846 6.37277 28.737 6.1989 28.6467 6.04652L28.6163 5.99532C28.5259 5.84271 28.3879 5.72397 28.2235 5.65729C28.1267 5.61801 28.0232 5.59782 27.9187 5.59782H27.8749C27.8048 5.59782 27.7349 5.60687 27.667 5.62476C27.4938 5.67043 27.3398 5.77275 27.23 5.91427C27.1598 6.00481 27.1089 6.10961 27.0814 6.22084L27.0569 6.31987C26.9815 6.62438 26.7798 6.88222 26.5023 7.02854C26.3442 7.11193 26.1681 7.15551 25.9893 7.15551H25.559C25.17 7.15551 24.7851 7.07555 24.4283 6.92059L23.4 6.47402L22.0462 5.76008L20.9089 5.27672C20.299 5.01748 19.643 4.88387 18.9803 4.88387H18.4934C18.4007 4.88387 18.3085 4.8956 18.2188 4.91876L17.6624 5.06247C17.2491 5.16923 16.8462 4.85227 16.8462 4.42538C16.8462 4.26231 16.9087 4.10397 17.0209 3.98563C17.0479 3.95711 17.0723 3.92616 17.0936 3.89317L17.2116 3.71072C17.4149 3.39616 17.5231 3.02957 17.5231 2.65501V2.52891C17.5231 2.28549 17.4619 2.04598 17.345 1.83243L17.3347 1.81362C17.1596 1.4934 16.8662 1.25435 16.5172 1.14748C16.2503 1.06576 15.9651 1.06576 15.6982 1.14748L15.6322 1.1677C15.3205 1.26313 15.0448 1.45011 14.8408 1.70434L14.8266 1.72211C14.6003 2.00418 14.4769 2.355 14.4769 2.71663C14.4769 3.04966 14.5815 3.37427 14.776 3.64463L14.9968 3.95161C15.0989 4.09356 15.1538 4.264 15.1538 4.43886V5.14827C15.1538 5.21732 15.0979 5.2733 15.0288 5.2733C15.0099 5.2733 14.9911 5.26898 14.9741 5.26068L14.6 5.07859C14.3368 4.95046 14.0479 4.88387 13.7551 4.88387H13.2777C13.0724 4.88387 12.8673 4.89968 12.6644 4.93116L12.481 4.9596C12.1098 5.01718 11.7443 5.10728 11.3889 5.22885L10.7846 5.43556L9.43077 6.05214L7.78784 6.83731C7.57082 6.94102 7.34421 7.02335 7.11123 7.08312L6.65393 7.20044C6.43596 7.25636 6.20845 7.26429 5.98711 7.22369L5.84285 7.19723C5.69338 7.16982 5.55266 7.10699 5.43246 7.01403C5.25268 6.87498 5.12862 6.67616 5.08274 6.45357Z"
          stroke={isCompare ? "#513E3E" : "black"}
          strokeWidth="1.2"
          strokeLinecap="round"
          strokeLinejoin="round"
          fill={isCompare ? "#5E4B4B" : "none"}
        />
      </svg>
    </button>
  );
}
